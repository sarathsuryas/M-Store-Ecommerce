<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="/userassets/css/checkout.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!--modal  -->

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>


</head>

<body>



    <div class="container">

        <div class="row">
            <div class="col-xl-8">

                <div class="card">
                    <div class="card-body">
                        <ol class="activity-checkout mb-0 px-4 mt-3">

                            <li class="checkout-item">
                               
                            </li>
                            <li class="checkout-item">
                                <div class="avatar checkout-icon p-1">
                                    <div class="avatar-title rounded-circle bg-primary">
                                        <i class="bx bxs-truck text-white font-size-20"></i>
                                    </div>
                                </div>
                                <div class="feed-item-list">
                                    <div>
                                        <h5 class="font-size-16 mb-1">Shipping Info</h5>
                                        <p class="text-muted text-truncate mb-4">Neque porro quisquam est</p>
                                        <div class="mb-3">
                                            <div class="row">
                                                <% if (address) { %>
                                                    <% var number=0 %>
                                                    <% address.address.forEach(item=> { %>
                                                        <div class="col-lg-4 col-sm-6">

                                                            <div data-bs-toggle="collapse">

                                                                <label class="card-radio-label mb-0">
                                                                    <input type="radio" name="address"
                                                                        id="info-address1" class="card-radio-input"
                                                                       
                                                                        onclick="addressFunction('<%= item.id %>')">

                                                                    <div class="card-radio text-truncate p-3">
                                                                        <span class="fs-14 mb-4 d-block">Address
                                                                            <%= ++number %></span>
                                                                        <span class="fs-14 mb-2 d-block">
                                                                            <%= item.name %>
                                                                        </span>
                                                                        <span
                                                                            class="text-muted fw-normal text-wrap mb-1 d-block">
                                                                            <%= item.homeAddress %>
                                                                        </span>

                                                                        <span class="text-muted fw-normal d-block">Pin.
                                                                            <%= item.pinCode %></span>
                                                                    </div>

                                                                </label>

                                                                <!-- Your pencil button -->
                                                                <!-- <div class="edit-btn bg-light  rounded">
                                                                    <a href="#" data-bs-toggle="tooltip"
                                                                        data-placement="top" title=""
                                                                        data-bs-original-title="Edit">
                                                                        <i class="bx bx-pencil font-size-16"></i>
                                                                    </a>
                                                                </div> -->


                                                            </div>

                                                        </div>
                                                        <% }); %>
                                                            <% } %>
                                                                <div class="col-lg-4 col-sm-6">
                                                                    <div>


                                                                    </div>
                                                              </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="checkout-item">
                                <div class="avatar checkout-icon p-1">
                                    <div class="avatar-title rounded-circle bg-primary">
                                        <i class="bx bxs-wallet-alt text-white font-size-20"></i>
                                    </div>
                                </div>
                                <div class="feed-item-list">
                                    <div class="text-center mb-4">
                                        <button type="button" class="btn btn-success" data-toggle="modal"
                                            data-target="#modalAddAddress">Add address</button>
                                    </div>


                                    <div>
                                        <h5 class="font-size-16 mb-1">Payment Info</h5>
                                        <p class="text-muted text-truncate mb-4">Duis arcu tortor, suscipit eget</p>
                                    </div>
                                    <div>
                                        <h5 class="font-size-14 mb-3">Payment method :</h5>
                                        <div class="row">
                                            <div class="col-lg-3 col-sm-6">
                                                <div data-bs-toggle="collapse">
                                                    <label class="card-radio-label">
                                                        <input type="radio" name="pay-method" id="pay-methodoption1"
                                                            class="card-radio-input" onclick="paymentType('wallet')">
                                                        <span class="card-radio py-3 text-center text-truncate">
                                                            <i class="bx bx-credit-card d-block h2 mb-3"></i>
                                                            Wallet
                                                        </span>
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="col-lg-3 col-sm-6">
                                                <div>
                                                    <label class="card-radio-label">
                                                        <input  type="radio" name="pay-method" id="pay-methodoption2"
                                                            class="card-radio-input"  onclick="paymentType('online-payment')">
                                                        <span class="card-radio py-3 text-center text-truncate">
                                                            <i class="bx bxl-paypal d-block h2 mb-3"></i>
                                                            Razor Pay

                                                        </span>
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="col-lg-3 col-sm-6">
                                                <div>
                                                    <label class="card-radio-label">
                                                        <input type="radio" name="pay-method" id="pay-methodoption3"
                                                            class="card-radio-input" 
                                                            onclick="paymentType('cod')">

                                                        <span class="card-radio py-3 text-center text-truncate">
                                                            <i class="bx bx-money d-block h2 mb-3"></i>
                                                            <span>Cash on Delivery</span>
                                                        </span>
                                                    </label>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ol>
                    </div>
                </div>

                <div class="row my-4">
                    <div class="col">
                        <a href="ecommerce-products.html" class="btn btn-link text-muted">
                            <i class="mdi mdi-arrow-left me-1"></i> Continue Shopping </a>
                    </div> <!-- end col -->
                    <div class="col">
                        <div class="text-end mt-2 mt-sm-0">
                            <a class="btn btn-success" id="rzp-button1" onclick="placeOrder('<%= couponCode %>','<%= cart.totalShipment %>')">
                                <i class="mdi mdi-cart-outline me-1"></i> Proceed </a>
                        </div>
                    </div> <!-- end col -->
                </div> <!-- end row-->
            </div>
            <div class="col-xl-4">
                <div class="card checkout-order-summary">
                    <div class="card-body">
                        <div class="p-3 bg-light mb-3">
                            <h5 class="font-size-16 mb-0">Order Summary <span class="float-end ms-2">#MN0124</span></h5>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-centered mb-0 table-nowrap">
                                <thead>
                                    <tr>
                                        <th class="border-top-0" style="width: 110px;" scope="col">Product</th>
                                        <th class="border-top-0" scope="col">Product Name</th>
                                        <th class="border-top-0" scope="col">Price</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% cart.products.forEach(item=> { %>
                                        <tr>

                                            <th scope="row"><img src="<%= item.productId.coverImage %>"
                                                    alt="product-img" title="product-img" class="avatar-lg rounded">
                                            </th>
                                            <td>
                                                <h5 class="badge bg text-wrap" style="width: 6rem;"><a href="#"
                                                        class="text-dark">
                                                        <%= item.productId.title %>
                                                    </a></h5>
                                                <p class="text-muted mb-0">
                                                    <i class="bx bxs-star text-warning"></i>
                                                    <i class="bx bxs-star text-warning"></i>
                                                    <i class="bx bxs-star text-warning"></i>
                                                    <i class="bx bxs-star text-warning"></i>
                                                    <i class="bx bxs-star-half text-warning"></i>
                                                </p>
                                                <p class="text-muted mb-0 mt-1">₹ <%= item.productId.price %> x <%=
                                                            item.quantity %>
                                                </p>
                                            </td>
                                            <td>
                                                <%= item.total %>
                                            </td>
                                        </tr>
                                        <% }); %>
                                        <tr>
                                            <td colspan="2">
                                                <h5 class="font-size-14 m-0">Cart Total</h5>
                                            </td>
                                            <td>
                                                <%= cart.cartTotal %>
                                            </td>
                                        </tr>
                                               
                                            <tr>
                                                <td colspan="2">
                                                    <h5 class="font-size-14 m-0">Shipping Charge</h5>
                                                </td>
                                                <td>
                                                    ₹40
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="2">
                                                    <h5 class="font-size-14 m-0">Subtotal</h5>
                                                </td>
                                                <td>
                                                    <%= cart.cartTotal+40 %>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="2">
                                                    <h5 class="font-size-14 m-0">Coupon Discount</h5>
                                                </td>
                                                <td id="totalDiscount">
                                                    0
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="2">
                                                    <h5 class="font-size-14 m-0">Total :</h5>
                                                </td>
                                                <td id="totalShipment">
                                                ₹<%= cart.totalShipment %>
                                                </td>
                                            </tr>
                                            <!-- <tr>
                                    <td colspan="2">
                                        <h5 class="font-size-14 m-0">Discount :</h5>
                                    </td>
                                    <td>
                                        - $ 78
                                    </td>
                                </tr> -->


                                            <!-- <tr>
                                    <td colspan="2">
                                        <h5 class="font-size-14 m-0">Estimated Tax :</h5>
                                    </td>
                                    <td>
                                        $ 18.20
                                    </td>
                                </tr>                               -->

                                            <!-- <tr class="bg-light">
                                    <td colspan="2">
                                        <h5 class="font-size-14 m-0">Total:</h5>
                                    </td>
                                    <td>
                                        $ 745.2
                                    </td>
                                </tr> -->
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end row -->
        <!-- modal -->

        <div class="modal fade" id="modalAddAddress" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h4 class="modal-title w-100 font-weight-bold">Add Address</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="/add-address" method="POST" onsubmit="return addAddress()">
                        <div class="form-row">
                            <div class="col-md-6 mb-4">
                                <label for="inputName">Name</label>
                                <input type="text" class="form-control" id="inputUsername" placeholder="Your name"
                                    name="username">
                                    <span style="color:red" id="usernameError"></span>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="inputMobile">Mobile Number</label>
                                <input type="tel" class="form-control" id="inputMobile"
                                    placeholder="10-digit mobile number" name="phoneNumber">
                                    <span style="color: red;" id="mobileError"></span>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col-md-6 mb-4">
                                <label for="inputPincode">Pincode</label>
                                <input type="text" class="form-control" id="inputPinCode" placeholder="Pincode"
                                    name="pincode">
                                    <span style="color:red" id="pincodeError"></span>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="inputLocality">Locality</label>
                                <input type="text" class="form-control" id="inputLocality" placeholder="Locality"
                                    name="locality">
                                    <span style="color: red;" id="localityError" ></span>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col-md-12 mb-4">
                                <label for="inputAddress">Address</label>
                                <input type="text" class="form-control" id="inputAddress" placeholder="Address"
                                    name="address">
                                    <span style="color: red;" id="addressError"></span>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col-md-6 mb-4">
                                <label for="inputCity">City/District/Town</label>
                                <input type="text" class="form-control" id="inputcdt"
                                    placeholder="City/District/Town" name="city">
                                    <span style="color: red;" id="cdtError"></span>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="selectState">Select State</label>
                                <select id="inputSelectState" name="selectedState" class="form-control">
                                    <!-- Include options for different states -->
                                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                    <option value="Assam">Assam</option>
                                    <option value="Bihar">Bihar</option>
                                    <option value="Chhattisgarh">Chhattisgarh</option>
                                    <option value="Goa">Goa</option>
                                    <option value="Gujarat">Gujarat</option>
                                    <option value="Haryana">Haryana</option>
                                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                                    <option value="Jharkhand">Jharkhand</option>
                                    <option value="Karnataka">Karnataka</option>
                                    <option value="Kerala">Kerala</option>
                                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                                    <option value="Maharashtra">Maharashtra</option>
                                    <option value="Manipur">Manipur</option>
                                    <option value="Meghalaya">Meghalaya</option>
                                    <option value="Mizoram">Mizoram</option>
                                    <option value="Nagaland">Nagaland</option>
                                    <option value="Odisha">Odisha</option>
                                    <option value="Punjab">Punjab</option>
                                    <option value="Rajasthan">Rajasthan</option>
                                    <option value="Sikkim">Sikkim</option>
                                    <option value="Tamil Nadu">Tamil Nadu</option>
                                    <option value="Telangana">Telangana</option>
                                    <option value="Tripura">Tripura</option>
                                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                                    <option value="Uttarakhand">Uttarakhand</option>
                                    <option value="West Bengal">West Bengal</option>
                                    <!-- Add more options as needed -->
                                </select>
                                <span style="color: red;" id="stateError"></span>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col-md-6 mb-4">
                                <label for="inputAlternatePhone">Alternate Phone</label>
                                <input type="tel" class="form-control" id="inputAltPhone"
                                    placeholder="Alternate phone" name="altPhone">
                                    <span style="color: red;" id="altError"></span>  
                            </div>
                        </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Save and Deliver Here <i
                            class="fas fa-truck ml-1"></i></button>
                </div>
                </form>
            </div>
        </div>
    </div>
        <!-- sweetalert link -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <!-- modal for adding the address -->
        
        <!-- Include jQuery library -->

    </div>
          <!-- validation for add address -->
    <script>
        function addAddress() {
          // Reset previous error messages
          resetErrors();
      
          // Basic form validation
          const username = document.getElementById('inputUsername').value.trim();
          const mobile = document.getElementById('inputMobile').value.trim();
          const pinCode = document.getElementById('inputPinCode').value.trim();
          const locality = document.getElementById('inputLocality').value.trim();
          const address = document.getElementById('inputAddress').value.trim();
          const cdt = document.getElementById('inputcdt').value.trim();
          const selectState = document.getElementById('inputSelectState').value.trim();
          const altPhone = document.getElementById('inputAltPhone').value.trim();
      
          // Validate each field
          if (!isValidText(username)) {
            showError('usernameError', 'Please enter a valid name with only letters.');
            return false;
          }
      
          if (!isValidMobile(mobile)) {
            showError('mobileError', 'Please enter a valid 10-digit mobile number.');
            return false;
          }
      
          if (!isValidPinCode(pinCode)) {
            showError('pincodeError', 'Please enter a valid 6-digit pin code.');
            return false;
          }
      
          if (!isValidText(locality)) {
            showError('localityError', 'Please enter a valid locality with only letters.');
            return false;
          }
      
          if (!isValidText(address)) {
            showError('addressError', 'Please enter a valid address with only letters.');
            return false;
          }
      
          if (!isValidText(cdt)) {
            showError('cdtError', 'Please enter a valid city/district/town with only letters.');
            return false;
          }
      
          if (!selectState) {
            showError('stateError', 'Please select your state.');
            return false;
          }
      
          if (altPhone && !isValidMobile(altPhone)) {
            showError('altError', 'Please enter a valid 10-digit alternate phone number or leave it blank.');
            return false;
          }
      
          // If all validation passes, the form will be submitted
          return true;
        }
      
        function isValidText(value) {
          // Allow only letters and spaces
          return /^[A-Za-z\s]+$/.test(value);
        }
      
        function isValidMobile(value) {
          // Allow only 10-digit mobile numbers
          return /^\d{10}$/.test(value);
        }
      
        function isValidPinCode(value) {
          // Allow only 6-digit pin codes
          return /^\d{6}$/.test(value);
        }
      
        function showError(elementId, errorMessage) {
          document.getElementById(elementId).textContent = errorMessage;
        }
      
        function resetErrors() {
          const errorElements = document.querySelectorAll('[id$="Error"]');
          errorElements.forEach(element => {
            element.textContent = '';
          });
        }
      </script>
      <!-- applying discount value -->
    <script>
        var totalShipment = document.getElementById('totalShipment').innerText
        totalShipment = totalShipment.replace('₹', '').trim();
        var numericShipment = parseFloat(totalShipment)
        var discount = localStorage.getItem('discount')
        
        const sum = totalShipment - discount
        document.getElementById('totalShipment').innerText = sum
        document.getElementById('totalDiscount').innerText = discount
        
    </script>


<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="/javascripts/user/placeOrder.js"></script>
    <script src="/javascripts/user/applyCoupon.js"></script>
</body>

</html>